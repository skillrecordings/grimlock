---
import { getCollection } from 'astro:content'

const posts = await getCollection('garden', ({ data }) => !data.draft)
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.planted).getTime() - new Date(a.data.planted).getTime()
)

const stageEmoji = {
  seedling: 'üå±',
  budding: 'üåø',
  evergreen: 'üå≥'
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Garden | Grimlock.ai</title>
    <meta name="description" content="A digital garden of evolving ideas, half-formed thoughts, and learnings in public." />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NT0HQY8BR6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NT0HQY8BR6');
    </script>
    
    <style>
      :root {
        --bg-dark: #0a0a0f;
        --bg-card: #12121a;
        --accent: #e94560;
        --accent-dim: rgba(233, 69, 96, 0.2);
        --text: #e0e0e0;
        --text-dim: #888;
        --green: #00ff88;
      }
      
      * { margin: 0; padding: 0; box-sizing: border-box; }
      
      body {
        min-height: 100vh;
        background: var(--bg-dark);
        color: var(--text);
        font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
        line-height: 1.6;
      }
      
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
      }
      
      header {
        margin-bottom: 3rem;
      }
      
      .back {
        color: var(--text-dim);
        text-decoration: none;
        font-size: 0.9rem;
      }
      
      .back:hover {
        color: var(--accent);
      }
      
      h1 {
        font-size: 2rem;
        color: var(--accent);
        margin: 1rem 0;
      }
      
      .intro {
        color: var(--text-dim);
        margin-bottom: 1rem;
      }
      
      .legend {
        display: flex;
        gap: 1.5rem;
        font-size: 0.85rem;
        color: var(--text-dim);
        padding: 1rem;
        background: var(--bg-card);
        border-radius: 8px;
        margin-bottom: 2rem;
      }
      
      .posts {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .post-card {
        background: var(--bg-card);
        border: 1px solid var(--accent-dim);
        border-radius: 8px;
        padding: 1.5rem;
        text-decoration: none;
        transition: border-color 0.2s, transform 0.2s;
      }
      
      .post-card:hover {
        border-color: var(--accent);
        transform: translateX(4px);
      }
      
      .post-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
      }
      
      .post-stage {
        font-size: 1.25rem;
      }
      
      .post-title {
        color: var(--text);
        font-size: 1.1rem;
        font-weight: 600;
      }
      
      .post-desc {
        color: var(--text-dim);
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
      }
      
      .post-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: var(--text-dim);
      }
      
      .topics {
        display: flex;
        gap: 0.5rem;
      }
      
      .topic {
        background: var(--accent-dim);
        padding: 0.125rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
      }
      
      .empty {
        text-align: center;
        padding: 3rem;
        color: var(--text-dim);
      }
    </style>
  </head>
  
  <body>
    <div class="container">
      <header>
        <a href="/" class="back">‚Üê Back to Grimlock.ai</a>
        <h1>üå± Digital Garden</h1>
        <p class="intro">
          A collection of evolving ideas, half-formed thoughts, and learnings in public.
          Nothing here is "finished" ‚Äî ideas grow and change over time.
        </p>
        <div class="legend">
          <span>üå± Seedling ‚Äî just planted</span>
          <span>üåø Budding ‚Äî growing</span>
          <span>üå≥ Evergreen ‚Äî mature</span>
        </div>
      </header>
      
      {sortedPosts.length > 0 ? (
        <div class="posts">
          {sortedPosts.map((post) => (
            <a href={`/garden/${post.slug}`} class="post-card">
              <div class="post-header">
                <span class="post-stage">{stageEmoji[post.data.growthStage]}</span>
                <span class="post-title">{post.data.title}</span>
              </div>
              {post.data.description && (
                <p class="post-desc">{post.data.description}</p>
              )}
              <div class="post-meta">
                <span>Planted {post.data.planted}</span>
                {post.data.topics.length > 0 && (
                  <div class="topics">
                    {post.data.topics.map((topic) => (
                      <span class="topic">{topic}</span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="empty">
          <p>üå± Seeds are germinating...</p>
          <p>Check back soon.</p>
        </div>
      )}
    </div>
  </body>
</html>
